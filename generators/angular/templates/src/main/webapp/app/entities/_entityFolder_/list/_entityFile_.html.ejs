<%#
 Copyright 2013-2025 the original author or authors from the JHipster project.

 This file is part of the JHipster project, see https://www.jhipster.tech/
 for more information.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      https://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-%>
<div class="entity-list">
    <h2 class="title" id="page-heading" data-cy="<%= entityClass %>Heading">
        <span>__jhiTranslateTag__('<%= i18nKeyPrefix %>.home.title')</span>
    </h2>
    <div class="list-buttons">
<%_ if (!readOnly) { _%>
        <a<% if (fineGrainedPermissions) { %> *jhiHasAnyAuthority="'<%= entityStateName %>.create'"<% } %> pButton type='button' id="jh-create-entity" class="jh-create-entity create-<%= entityUrl %>" [routerLink]="['/<%= entityPage %>/new']" icon="pi pi-plus" iconPos="left" data-cy="entityCreateButton">
            __jhiTranslateTag__('<%= i18nKeyPrefix %>.home.createLabel')
        </a>
<%_ } _%>
    </div>

    <div class="list-content">
<%_ if (searchEngineAny) { _%>
        <div class="row">
            <div class="col-sm-12">
                <form name="searchForm" class="form-inline">
                    <div class="input-group w-100 mt-3">
                        <input type="text" class="form-control" [(ngModel)]="currentSearch" id="currentSearch" name="currentSearch" placeholder="__jhiTranslatePipe__('<%= i18nKeyPrefix %>.home.search')">
                        <button pButton (click)="search(currentSearch())" icon="pi pi-search"></button>
                        @if (currentSearch()) {
                            <button pButton class="p-button-danger" (click)="search('')" icon="pi pi-trash"></button>
                        }
                    </div>
                </form>
            </div>
        </div>
<%_ } _%>
        <p-table #<%= entityInstance %>Table [value]="<%= entityInstancePlural %>()" [rowTrackBy]="track<%= primaryKey.nameCapitalized %>"<%
    if (paginationPagination || paginationInfiniteScroll) {
        %> [lazy]="true" [rows]="itemsPerPage()" [totalRecords]="totalItems()" [loading]="isLoading()" sortMode="multiple"<%
        if (paginationInfiniteScroll) {
            %> [scrollable]="true" [virtualScroll]="true" (onLazyLoad)="onLazyLoadEvent($event)" scrollHeight="200px" [virtualScrollItemSize]="34"
               [showCurrentPageReport]="true" [currentPageReportTemplate]="'list.tableReportTemplate' | translate: { first: '{first}', last: '{last}' , totalRecords: '{totalRecords}' }"<%
        } else if (paginationPagination) {
            %> [paginator]="true" (onLazyLoad)="onLazyLoadEvent($event)"<%
        }
    }
    %>>
<%_ if (searchEngineElasticsearch) { _%>
            <ng-template pTemplate="caption">
                <div style="text-align: right">
                    <i class="pi pi-search" style="margin:4px 4px 0 0"></i>
                </div>
            </ng-template>
<%_ } _%>
            <ng-template pTemplate="header">
                <tr>
<%_ for (const field of fields.filter(field => !field.hidden)) {
    const fieldType = field.fieldType;
_%>
                    <th<% if (paginationPagination || paginationInfiniteScroll) { %> pSortableColumn="<%= field.fieldName %>"<% } %>>
                        <span>__jhiTranslateTag__('<%= field.fieldTranslationKey %>')</span>
<%_ if (paginationPagination || paginationInfiniteScroll) { _%>
                        <p-sortIcon field="<%= field.fieldName %>"></p-sortIcon>
<%_ } _%>
<%_ if (jpaMetamodelFiltering) { _%>
    <%_ if (['byte[]', 'ByteBuffer'].includes(fieldType)) { _%>
    <%_ } else if (fieldType === 'Boolean') { _%>
                        <p-columnFilter type="boolean" matchMode="equals" field="<%= field.fieldName %>" display="menu" [showOperator]="false" class="p-ml-auto"></p-columnFilter>
    <%_ } else if (field.fieldIsEnum) { _%>
                        <p-columnFilter field="<%= field.fieldName %>" matchMode="in" display="menu" [showOperator]="false" [showMatchModes]="false" [showAddButton]="false" class="p-ml-auto">
                            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                <p-multiSelect [ngModel]="value" [options]="<%= field.fieldName %>Options!" (onChange)="filter($event.value)">
                                    <ng-template let-<%= field.fieldName %> pTemplate="item">{{'<%= `${frontendAppName}.${field.fieldType}` %>.' + <%= field.fieldName %>.label | translate}}</ng-template>
                                </p-multiSelect>
                            </ng-template>
                        </p-columnFilter>
    <%_ } else if (['Instant', 'ZonedDateTime'].includes(fieldType)) { _%>
                        <p-columnFilter type="dateTime" field="<%= field.fieldName %>" display="menu" [showOperator]="false" class="p-ml-auto">
                            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                <p-datepicker [ngModel]="value" (ngModelChange)="filter($event)" [showTime]="true"></p-datepicker>
                            </ng-template>
                        </p-columnFilter>
    <%_ } else if (fieldType === 'LocalDate') { _%>
                        <p-columnFilter type="date" field="<%= field.fieldName %>" display="menu" [showOperator]="false" class="p-ml-auto"></p-columnFilter>
    <%_ } else if (['Integer', 'Long', 'Float', 'Double', 'BigDecimal', 'Duration'].includes(fieldType)) { _%>
                        <p-columnFilter type="numeric" field="<%= field.fieldName %>" display="menu" [showOperator]="false" class="p-ml-auto"></p-columnFilter>
    <%_ } else { _%>
                        <p-columnFilter type="text" matchMode="contains" field="<%= field.fieldName %>" display="menu" [showOperator]="false" class="p-ml-auto"></p-columnFilter>
    <%_ } _%>
<%_ } _%>
                    </th>
<%_ } _%>
<%_ for (const relationship of relationships.filter(r => r.ownerSide)) { _%>
    <%_ if (relationship.relationshipManyToMany) { _%>
        <%_ if (paginationNo && relationship.otherEntity.entityClass !== 'User' && !relationship.otherEntity.primaryKey.composite) { _%>
                    <th<% if (fineGrainedPermissions) { %> *jhiHasAnyAuthority="'<%= relationship.otherEntityStateName %>.read'"<% } %>>
                        <span>__jhiTranslateTag__('<%= i18nKeyPrefix %>.<%= relationship.relationshipName %>')</span>
            <%_ if (jpaMetamodelFiltering) { _%>
                        <p-columnFilter field="<%= relationship.relationshipName %>" matchMode="in" display="menu" [showOperator]="false" [showMatchModes]="false" [showAddButton]="false" class="p-ml-auto">
                            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                <p-multiSelect [ngModel]="value" [options]="<%= relationship.relationshipName %>Options" (onChange)="filter($event.value)" optionLabel="<%= relationship.otherEntityField %>" optionValue="<%= relationship.otherEntity.primaryKey.name %>"<% if(relationship.otherEntity.pagination !== 'no') { %>
                                           [lazy]="true" [virtualScroll]="true" [virtualScrollItemSize]="38" [lazySelectedOptions]="<%= relationship.relationshipName %>SelectedOptions!" (onLazyLoad)="on<%= relationship.otherEntityNameCapitalized %>LazyLoadEvent($event)"<% } %>></p-multiSelect>
                            </ng-template>
                        </p-columnFilter>
            <%_ } _%>
                    </th>
        <%_ } _%>
    <%_ } else { _%>
        <%_ relationship.clientFields.forEach(cf => { _%>
                    <th<% if (fineGrainedPermissions) { %> *jhiHasAnyAuthority="'<%= cf.entity.entityStateName %>.read'"<% } %><% if (paginationPagination || paginationInfiniteScroll) { %> pSortableColumn="<%= relationship.relationshipName %>.<%= cf.relatedFieldPath.join('.') %>"<% } %>>
                        <span>__jhiTranslateTag__('<%= cf.translationKey %>')</span>
            <%_ if (paginationPagination || paginationInfiniteScroll) { _%>
                        <p-sortIcon field="<%= relationship.relationshipName %>.<%= cf.relatedFieldPath.join('.') %>"></p-sortIcon>
            <%_ } _%>
            <%_ if (jpaMetamodelFiltering) { _%>
                        <p-columnFilter field="<%= relationship.relationshipFieldName + cf.id.fieldNameCapitalized %>" matchMode="in" display="menu" [showOperator]="false" [showMatchModes]="false" [showAddButton]="false" class="p-ml-auto">
                            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                <p-multiSelect [ngModel]="value" (onChange)="filter($event.value)" optionLabel="<%= cf.lastRelationship.otherEntityField %>" optionValue="<%= cf.fieldName %>"
                                <%_ if(cf.lastRelationship.otherEntity.pagination !== 'no') { _%>
                                           [options]="<%= cf.name %>OptionsSubscriber!.options()" [lazy]="true" [virtualScroll]="true" [virtualScrollItemSize]="38" [lazySelectedOptions]="<%= cf.name %>SelectedOptions!" (onLazyLoad)="on<%= cf.nameCapitalized %>LazyLoadEvent($event)"
                                <%_ } else { _%>
                                           [options]="<%= cf.name %>Options!"
                                <%_ } _%>
                                ></p-multiSelect>
                            </ng-template>
                        </p-columnFilter>
            <%_ } _%>
                    </th>
        <%_ }) _%>
    <%_ } _%>
<%_ } _%>
                    <th style="width: 124px"></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-<%= entityInstance %>>
                <tr data-cy="entityTable">
<%_
    const keys = primaryKey.fields.length === 1 ? `${entityInstance}.${primaryKey.name}` : `{ ${primaryKey.fields.map(field => `${field.fieldName}: ${entityInstance}.${field.nameDottedAsserted}`).join(', ')} }`;
    const routerLink = ` [routerLink]="['/${ entityPage }', ${ keys }, 'view']"`;
    for (const field of fields.filter(field => !field.hidden)) {
        const fieldName = field.fieldName;
        const fieldType = field.fieldType;
        const fieldTypeBlobContent = field.fieldTypeBlobContent;
_%>
    <%_ if (field.fieldTypeBinary && field.blobContentTypeImage) { _%>
                    <td>
                        @if (<%= entityInstance %>.<%= fieldName %>) {
                            <a (click)="openFile(<%= entityInstance %>.<%= fieldName %>, <%= entityInstance %>.<%= fieldName %>ContentType)">
                                <img [src]="'data:' + <%= entityInstance %>.<%= fieldName %>ContentType + ';base64,' + <%= entityInstance %>.<%= fieldName %>" style="max-height: 30px;" alt="<%= entityInstance %> image"/>
                            </a>
                            <span>{{ <%= entityInstance %>.<%= fieldName %>ContentType }}, {{ byteSize(<%= entityInstance %>.<%= fieldName %>) }}</span>
                        }
                    </td>
    <%_ } else if (field.fieldTypeBinary && field.blobContentTypeAny) { _%>
                    <td>
                        @if (<%= entityInstance %>.<%= fieldName %>) {
                            <a (click)="openFile(<%= entityInstance %>.<%= fieldName %>, <%= entityInstance %>.<%= fieldName %>ContentType)">__jhiTranslateTag__('entity.action.open')</a>
                            <span>{{ <%= entityInstance %>.<%= fieldName %>ContentType }}, {{ byteSize(<%= entityInstance %>.<%= fieldName %>) }}</span>
                        }
                    </td>
    <%_ } else if (field.fieldIsEnum) { _%>
                    <td<% if (field.id) { %>><a<%- routerLink %><% } %> <%= jhiPrefix %>Translate="{{ '<%= frontendAppName %>.<%= fieldType %>.' + <%= entityInstance %>.<%= fieldName %> }}">{{ <%= entityInstance %>.<%= fieldName %> }}<% if (field.id) { %></a><% } %></td>
    <%_ } else if (field.fieldTypeTimed) { _%>
                    <td>{{ <%= entityInstance %>.<%= fieldName %> | date:'medium' }}</td>
    <%_ } else if (field.fieldTypeLocalDate) { _%>
                    <td>{{ <%= entityInstance %>.<%= fieldName %> | date:'mediumDate' }}</td>
    <%_ } else if (field.fieldTypeDuration) { _%>
                    <td title="{{ <%= entityInstance %>.<%= fieldName %> }}">{{ <%= entityInstance %>.<%= fieldName %> | duration }}</td>
    <%_ } else { _%>
                    <td<% if (field.id) { %>><a<%- routerLink %><% } %>>{{ <%= entityInstance %>.<%= fieldName %> }}<% if (field.id) { %></a><% } %></td>
    <%_ } _%>
<%_ } _%>
<%_ for (const relationship of relationships.filter(rel => rel.ownerSide)) {
    const relationshipFieldName = relationship.relationshipFieldName;
    const relationshipFieldNamePlural = relationship.relationshipFieldNamePlural;
    const otherEntityName = relationship.otherEntityName;
    const otherEntity = relationship.otherEntity;
    const otherEntityStateName = relationship.otherEntityStateName;
    const instance = relationship.relationshipManyToMany ? relationshipFieldName : `${entityInstance}.${relationshipFieldName}`;
_%>
    <%_ if (otherEntityName === 'user') { _%>
        <%_ if (relationship.relationshipManyToMany) { _%>
                    <td<% if (fineGrainedPermissions) { %> *jhiHasAnyAuthority="'<%= otherEntityStateName %>.read'"<% } %>>
                        @for (<%= relationshipFieldName %> of <%= entityInstance %>.<%= relationshipFieldNamePlural %>; track $index; let last = $last) {
                            <span>{{ <%= instance %>.<%= relationship.otherEntityField %> }}{{ last ? '' : ', ' }}</span>
                        }
                    </td>
        <%_ } else { _%>
                    <td<% if (fineGrainedPermissions) { %> *jhiHasAnyAuthority="'<%= otherEntityStateName %>.read'"<% } %>>
                        @if (<%= entityInstance %>.<%= relationshipFieldName %>) {
                            <div>{{ <%= instance %>.<%= relationship.otherEntityField %> }}</div>
                        }
                    </td>
        <%_ } _%>
    <%_ } else { _%>
        <%_ if (relationship.relationshipManyToMany) { _%>
            <%_ if (paginationNo && otherEntity.entityClass !== 'User' && !otherEntity.primaryKey.composite) { _%>
                    <td<% if (fineGrainedPermissions) { %> *jhiHasAnyAuthority="'<%= otherEntityStateName %>.read'"<% } %>>
                        @for (<%= relationshipFieldName %> of <%= entityInstance %>.<%= relationshipFieldNamePlural %>; track $index; let last = $last) {
                            <%_ const manyRelationshipKeys = otherEntity.primaryKey.fields.length === 1 ? `${instance}.${otherEntity.primaryKey.name}!` : `{ ${otherEntity.primaryKey.fields.map(field => `${field.fieldName}: ${instance}.${field.nameDottedAsserted}`).join(', ')} }`; _%>
                            <span>
                                <a class="form-control-static" [routerLink]="['/<%= otherEntity.entityPage %>', <%= manyRelationshipKeys %>, 'view']">{{ <%= instance %>.<%= relationship.otherEntityField %> }}</a>{{ last ? '' : ', ' }}
                            </span>
                        }
                    </td>
            <%_ } _%>
        <%_ } else { _%>
            <%_ relationship.clientFields.forEach(cf => {
                const relationshipKeys = cf.entity.primaryKey && cf.entity.primaryKey.composite ?
                    `{ ${cf.routerLinkValues.map(v => `${v.fieldName}: ${entityInstance}.${relationship.relationshipName}.${v.nameDotted}`).join(', ')} }` :
                    `${cf.routerLinkValues.map(v => `${entityInstance}.${relationship.relationshipName}.${v.nameDotted}`).join('')}`;
                const cfRouterLink = `[routerLink]="['/${ cf.entity.entityPage }', ${ relationshipKeys }, 'view']"`;
            _%>
                    <td<% if (fineGrainedPermissions) { %> *jhiHasAnyAuthority="'<%= cf.entity.entityStateName %>.read'"<% } %>>
                        @if (<%= entityInstance %>.<%= relationship.relationshipName %>) {
                            <div>
                                <a <%- cfRouterLink %>>{{ <%= instance %>.<%= cf.relatedFieldPath.join('.') %> }}</a>
                            </div>
                        }
                    </td>
            <%_ }) _%>
        <%_ } _%>
    <%_ } _%>
<%_ } _%>
                    <td>
                        <div class="btn-group flex-btn-group-container">
<%_ const idParam = primaryKey.fields.length === 1 ? `${entityInstance}.${primaryKey.name}!` : '{ '+ primaryKey.fields.map(field => `${field.fieldName}: ${entityInstance}.${field.nameDottedAsserted}`).join(', ') + ' }'; _%>
                            <a pButton type="button" [routerLink]="['/<%= entityPage %>', <%- idParam %>, 'view']"
                                  class="p-button-icon-only p-button-info" data-cy="entityDetailsButton">
                                <span class="p-button-icon pi pi-eye"></span>
                            </a>
<%_ if (!readOnly && updatableEntity) { _%>
                            <a<% if (fineGrainedPermissions) { %> *jhiHasAnyAuthority="'<%= entityStateName %>.update'"<% } %> pButton type="button" [routerLink]="['/<%= entityPage %>', <%- idParam %>, 'edit']"
                                  class="p-button-icon-only p-button-warning" data-cy="entityEditButton">
                                <span class="p-button-icon pi pi-pencil"></span>
                            </a>
<%_ } _%>
<%_ if (!readOnly) { _%>
    <%_ if (primaryKey.fields.length === 1) { _%>
                            <button<% if (fineGrainedPermissions) { %> *jhiHasAnyAuthority="'<%= entityStateName %>.update'"<% } %> pButton type="button" (click)="delete(<%= entityInstance %>)"
                                  class="p-button-icon-only p-button-danger" data-cy="entityDeleteButton">
                                <span class="p-button-icon pi pi-times"></span>
                            </button>
    <%_ } else { _%>
                            <button<% if (fineGrainedPermissions) { %> *jhiHasAnyAuthority="'<%= entityStateName %>.delete'"<% } %> pButton type="button" (click)="delete(<%= entityInstance %>)"
                              class="p-button-icon-only p-button-danger" data-cy="entityDeleteButton">
                                <span class="p-button-icon pi pi-times"></span>
                            </button>
    <%_ } _%>
<%_ } _%>
                        </div>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td [attr.colspan]="<%= fields.filter(f => !f.hidden).length + relationships.filter(r => r.ownerSide).length + 1 %>">
                        <span>__jhiTranslateTag__('<%= i18nKeyPrefix %>.home.notFound')</span>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>
